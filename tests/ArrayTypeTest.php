<?php

namespace TheRealGambo\Ramlfications\Test;

use TheRealGambo\Ramlfications\Nodes\RootNode;
use TheRealGambo\Ramlfications\Parser;

class ArrayTypeTest extends \PHPUnit_Framework_TestCase
{
    public function setUp()
    {
        parent::setUp(); // TODO: Change the autogenerated stub
    }

    private function loadRaml(string $file): RootNode
    {
        $parser = new Parser();
        $data = $parser->parseFile($file, __DIR__ . '/raml/1.0/types/');
        $raml = $parser->parseRaml($data);
        return $raml;
    }

    public function testArrayTypeSingleTypeValid()
    {
        $raml = $this->loadRaml('arrayType.raml');
        $resource = $raml->getResourceByPath('/email');
        $method = $resource->getMethod('get');
        $response = $method->getResponse(200);
        $body = $response->getBodyByType('application/json');
        $type = $body->getType();

        $type->validate(json_decode('{"subject":"toto","body":"tata"}', true));
    }

    public function testArrayTypeSingleTypeInvalid()
    {
        $raml = $this->loadRaml('arrayType.raml');
        $resource = $raml->getResourceByPath('/email');
        $method = $resource->getMethod('get');
        $response = $method->getResponse(200);
        $body = $response->getBodyByType('application/json');
        $type = $body->getType();

        $type->validate(json_decode('{"subject":"toto","body":"tata", "invalid": true}', true));
    }
}